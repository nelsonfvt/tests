%% Inicio
[rows,cols]=size(DDHr);
t_vecs=find(WNueLi);

%% Upsampling parches LR
ddLR=DDLR(:,t_vecs); %sacando parches de trabajo
ddHR=patch_ups(ddLR);

%% buscar conjuntos de parches semejantes

B_sim=pch_sim(ddHR,DDHr);

%% Permutaciones

B_per=permutaciones(B_sim);
% v=1:n_sim;
% C=perms(v);
% ns=1:4:length(C(:,1));
% C=C(ns,:);
% n_per=length(C(:,1));
% B_perm=zeros(rows,n_sim,n_per);
% for i=1:n_per
%     for j=1:n_sim
%         vec=B_sim(:,j,C(i,j));
%         B_perm(:,j,i)=vec;
%     end 
% end

%% Buscar parches HR con cov semejante
cov_base = extract_cov(cov(ddHR));

[~,~,n_per]=size(B_per);
for k=1:n_sim
    covs(:,k)=extract_cov(cov(B_sim(:,:,k)));
    vals(:,k)=dot(cov_base,covs(:,k));
end
